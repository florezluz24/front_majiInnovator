<div class="catalogo-container">
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
      <a class="navbar-brand fw-bold" href="#" (click)="volverAlMenu(); $event.preventDefault()" style="cursor: pointer;">
        <i class="bi bi-arrow-left"></i> MAJI Innovators S.A.S
      </a>
      <div class="navbar-nav ms-auto">
        <button class="btn btn-outline-light me-2" (click)="debugEstado()">
          <i class="bi bi-bug"></i> Debug
        </button>
        <button class="btn btn-outline-light" (click)="recargarCatalogo()" [disabled]="isLoading">
          <i class="bi bi-arrow-clockwise"></i> Actualizar
        </button>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="container py-5">
    <!-- Header Section -->
    <div class="row mb-5">
      <div class="col-12 text-center">
        <div class="card border-0 bg-primary text-white">
          <div class="card-body py-4">
            <h1 class="display-5 fw-bold mb-3">
              <i class="bi bi-phone"></i> Catálogo de Productos
            </h1>
            <p class="lead mb-0">Descubre nuestra amplia gama de celulares y accesorios</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="row">
      <div class="col-12 text-center">
        <div class="card border-0 shadow-sm">
          <div class="card-body py-5">
            <div class="spinner-border text-primary mb-3" role="status">
              <span class="visually-hidden">Cargando...</span>
            </div>
            <h5 class="text-muted">Cargando catálogo...</h5>
            <p class="text-muted">Por favor espera mientras obtenemos los productos</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Error State -->
    <div *ngIf="errorMessage && !isLoading" class="row">
      <div class="col-12">
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
          <i class="bi bi-exclamation-triangle-fill me-2"></i>
          {{ errorMessage }}
          <button type="button" class="btn-close" (click)="errorMessage = ''" aria-label="Close"></button>
        </div>
      </div>
    </div>

    <!-- Debug Panel -->
    <div class="row mb-3" *ngIf="!isLoading">
      <div class="col-12">
        <div class="alert alert-info">
          <strong>Debug:</strong> 
          isLoading: {{ isLoading }}, 
          errorMessage: "{{ errorMessage }}", 
          catalogo.length: {{ catalogo.length }}
        </div>
      </div>
    </div>

    <!-- Catalog Content -->
    <div *ngIf="!isLoading && !errorMessage" class="catalogo-content">
      <!-- Brands Section -->
      <div *ngFor="let marca of catalogo" class="marca-section mb-5">
        <div class="row mb-4">
          <div class="col-12">
            <div class="card border-0 bg-light">
              <div class="card-body py-4">
                <h2 class="fw-bold text-primary mb-2">
                  <i class="bi bi-building"></i> {{ marca.nombre }}
                </h2>
                <p *ngIf="marca.descripcion" class="text-muted mb-0">{{ marca.descripcion }}</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Models Grid -->
        <div class="row g-4">
          <div *ngFor="let modelo of marca.modelos" class="col-md-6 col-lg-4">
            <div class="card h-100 border-0 shadow-sm modelo-card">
              <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-start mb-3">
                  <h5 class="card-title fw-bold text-dark mb-0">{{ modelo.nombre }}</h5>
                  <span class="badge" [ngClass]="getDisponibilidadClass(modelo.disponible)">
                    {{ getDisponibilidadText(modelo.disponible) }}
                  </span>
                </div>
                
                <p *ngIf="modelo.descripcion" class="card-text text-muted small mb-3">
                  {{ modelo.descripcion }}
                </p>

                <div class="mb-3">
                  <h4 class="text-primary fw-bold mb-0">{{ formatearPrecio(modelo.precio) }}</h4>
                </div>

                <!-- Characteristics Preview -->
                <div *ngIf="modelo.caracteristicas.length > 0" class="mb-3">
                  <h6 class="fw-semibold text-dark mb-2">Características principales:</h6>
                  <div class="row g-2">
                    <div *ngFor="let caracteristica of modelo.caracteristicas.slice(0, 3)" class="col-12">
                      <div class="d-flex justify-content-between">
                        <span class="text-muted small">{{ caracteristica.nombre }}:</span>
                        <span class="fw-semibold small">{{ caracteristica.valor }}</span>
                      </div>
                    </div>
                    <div *ngIf="modelo.caracteristicas.length > 3" class="col-12">
                      <small class="text-muted">+{{ modelo.caracteristicas.length - 3 }} características más</small>
                    </div>
                  </div>
                </div>

                <div class="d-grid">
                  <button 
                    class="btn btn-outline-primary" 
                    (click)="seleccionarModelo(modelo)"
                    [disabled]="!modelo.disponible"
                  >
                    <i class="bi bi-eye"></i> Ver Detalles
                  </button>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="catalogo.length === 0" class="row">
        <div class="col-12 text-center">
          <div class="card border-0 shadow-sm">
            <div class="card-body py-5">
              <i class="bi bi-inbox text-muted" style="font-size: 4rem;"></i>
              <h5 class="text-muted mt-3">No hay productos disponibles</h5>
              <p class="text-muted">El catálogo está vacío en este momento</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Model Details Modal -->
  <div *ngIf="modeloSeleccionado" class="modal fade show d-block" tabindex="-1" style="background-color: rgba(0,0,0,0.5);">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title fw-bold">
            <i class="bi bi-phone"></i> {{ modeloSeleccionado.nombre }}
          </h5>
          <button type="button" class="btn-close" (click)="cerrarDetalles()" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Price and Availability -->
          <div class="row mb-4">
            <div class="col-md-6">
              <h4 class="text-primary fw-bold">{{ formatearPrecio(modeloSeleccionado.precio) }}</h4>
            </div>
            <div class="col-md-6 text-end">
              <span class="badge fs-6" [ngClass]="getDisponibilidadClass(modeloSeleccionado.disponible)">
                {{ getDisponibilidadText(modeloSeleccionado.disponible) }}
              </span>
            </div>
          </div>

          <!-- Description -->
          <div *ngIf="modeloSeleccionado.descripcion" class="mb-4">
            <h6 class="fw-semibold">Descripción:</h6>
            <p class="text-muted">{{ modeloSeleccionado.descripcion }}</p>
          </div>

          <!-- Images Section -->
          <div class="mb-4">
            <h6 class="fw-semibold mb-3">Imágenes del producto:</h6>
            
            <!-- Loading Images -->
            <div *ngIf="cargandoImagenes" class="text-center py-3">
              <div class="spinner-border spinner-border-sm text-primary" role="status">
                <span class="visually-hidden">Cargando imágenes...</span>
              </div>
              <span class="ms-2 text-muted">Cargando imágenes...</span>
            </div>

            <!-- Images Grid -->
            <div *ngIf="!cargandoImagenes && imagenesModelo.length > 0" class="row g-3">
              <div *ngFor="let imagen of imagenesModelo" class="col-md-6">
                <div class="card border-0 shadow-sm">
                  <img 
                    [src]="imagen.rutaImagen" 
                    [alt]="modeloSeleccionado.nombre"
                    class="card-img-top img-fluid"
                    style="height: 200px; object-fit: cover;"
                    (error)="$event.target.src='assets/placeholder-image.jpg'"
                  >
                </div>
              </div>
            </div>

            <!-- No Images -->
            <div *ngIf="!cargandoImagenes && imagenesModelo.length === 0" class="text-center py-4">
              <i class="bi bi-image text-muted" style="font-size: 3rem;"></i>
              <p class="text-muted mt-2">No hay imágenes disponibles para este producto</p>
            </div>
          </div>

          <!-- Characteristics -->
          <div *ngIf="modeloSeleccionado.caracteristicas.length > 0">
            <h6 class="fw-semibold mb-3">Especificaciones técnicas:</h6>
            <div class="row g-3">
              <div *ngFor="let caracteristica of modeloSeleccionado.caracteristicas" class="col-md-6">
                <div class="card border-0 bg-light">
                  <div class="card-body p-3">
                    <div class="d-flex justify-content-between align-items-center">
                      <span class="fw-semibold text-dark">{{ caracteristica.nombre }}</span>
                      <span class="text-primary fw-bold">{{ caracteristica.valor }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="cerrarDetalles()">
            <i class="bi bi-x-circle"></i> Cerrar
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
